<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halftonish - SDF Halftone Pattern Generator</title>
    <meta name="description" content="Generate and apply SDF-based halftone patterns using space-filling curves">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Halftonish</h1>
            <p class="subtitle">SDF-based Halftone Pattern Generator</p>
        </header>

        <main>
            <!-- Pattern Generation Section -->
            <section class="panel">
                <h2>Generate Pattern</h2>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                    Create halftone patterns using signed distance fields. Specify size in pixels or physical dimensions.
                </p>

                <div class="controls">
                    <div class="control-group">
                        <label for="pattern-select">Pattern:</label>
                        <select id="pattern-select">
                            <option value="random">Random</option>
                            <option value="noise">Noise</option>
                            <option value="benday">Ben-Day Dots</option>
                            <option value="hilbert">Hilbert Curve</option>
                            <option value="peano">Peano Curve</option>
                            <option value="zorder">Z-Order Curve</option>
                            <option value="gosper">Gosper Curve</option>
                        </select>
                    </div>

                    <!-- Random Pattern Parameters -->
                    <div id="random-params" class="pattern-params" style="display: none;">
                        <div class="control-group">
                            <label for="random-distribution">Distribution:</label>
                            <select id="random-distribution">
                                <option value="uniform">Uniform</option>
                                <option value="normal">Normal (Gaussian)</option>
                                <option value="binary">Binary (Black/White)</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="random-seed">Seed (optional):</label>
                            <input type="number" id="random-seed" placeholder="Leave empty for random">
                        </div>
                    </div>

                    <!-- Noise Pattern Parameters -->
                    <div id="noise-params" class="pattern-params" style="display: none;">
                        <div class="control-group">
                            <label for="noise-scale">
                                Scale: <span id="noise-scale-value">1.0</span>
                            </label>
                            <input type="range" id="noise-scale" min="0.1" max="10.0" value="1.0" step="0.1">
                        </div>
                        <div class="control-group">
                            <label for="noise-octaves">
                                Octaves: <span id="noise-octaves-value">4</span>
                            </label>
                            <input type="range" id="noise-octaves" min="1" max="8" value="4" step="1">
                        </div>
                        <div class="control-group">
                            <label for="noise-persistence">
                                Persistence: <span id="noise-persistence-value">0.5</span>
                            </label>
                            <input type="range" id="noise-persistence" min="0.0" max="1.0" value="0.5" step="0.05">
                        </div>
                        <div class="control-group">
                            <label for="noise-seed">Seed (optional):</label>
                            <input type="number" id="noise-seed" placeholder="Leave empty for random">
                        </div>
                    </div>

                    <!-- Ben-Day Dots Parameters -->
                    <div id="benday-params" class="pattern-params" style="display: none;">
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.75rem;">
                            Linear distance field from grid points. 0 (black) at dot centers, 255 (white) at grid cell corners.
                            When halftoned, produces classic dot screening.
                        </p>
                        <div class="control-group">
                            <label for="benday-spacing">
                                Dot Spacing (px): <span id="benday-spacing-value">20</span>
                            </label>
                            <input type="range" id="benday-spacing" min="5" max="100" value="20" step="1">
                        </div>
                        <!-- Dot Size control hidden - not used in linear SDF
                        <div class="control-group">
                            <label for="benday-size">
                                Dot Size: <span id="benday-size-value">0.70</span>
                            </label>
                            <input type="range" id="benday-size" min="0.1" max="1.0" value="0.7" step="0.05">
                        </div>
                        -->
                        <div class="control-group">
                            <label for="benday-shape">Dot Shape:</label>
                            <select id="benday-shape">
                                <option value="circle">Circle</option>
                                <option value="square">Square</option>
                                <option value="diamond">Diamond</option>
                            </select>
                            <span style="font-size: 0.8rem; color: var(--text-secondary);">
                                (Not yet implemented - currently uses circular distance)
                            </span>
                        </div>
                        <div class="control-group">
                            <label for="benday-grid">Grid Type:</label>
                            <select id="benday-grid">
                                <option value="square">Square</option>
                                <option value="hexagonal">Hexagonal</option>
                            </select>
                        </div>
                        <div class="control-group checkbox" style="display: none;">
                            <label>
                                <input type="checkbox" id="benday-antialiasing" checked>
                                Anti-aliasing
                            </label>
                        </div>
                    </div>

                    <!-- Hilbert Curve Parameters -->
                    <div id="hilbert-params" class="pattern-params" style="display: none;">
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.75rem;">
                            Space-filling Hilbert curve as SDF pattern. Higher iterations create more complex curves.
                            The curve is rendered as a distance field with configurable line width.
                        </p>
                        <div class="control-group">
                            <label for="iterations">
                                Iterations: <span id="iterations-value">5</span>
                            </label>
                            <input type="range" id="iterations" min="1" max="8" value="5" step="1">
                        </div>
                        <div class="control-group">
                            <label for="line-width">
                                Line Width: <span id="line-width-value">2.0</span>
                            </label>
                            <input type="range" id="line-width" min="0.5" max="10.0" value="2.0" step="0.1">
                        </div>
                    </div>

                    <!-- Peano Curve Parameters -->
                    <div id="peano-params" class="pattern-params" style="display: none;">
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.75rem;">
                            Peano space-filling curve using 3×3 subdivision. Creates a more rectangular meandering pattern
                            compared to Hilbert. Recommended max iterations: 5-6 (grows as 3^n).
                        </p>
                        <div class="control-group">
                            <label for="iterations">
                                Iterations: <span id="iterations-value">4</span>
                            </label>
                            <input type="range" id="iterations" min="1" max="6" value="4" step="1">
                        </div>
                        <div class="control-group">
                            <label for="line-width">
                                Line Width: <span id="line-width-value">2.0</span>
                            </label>
                            <input type="range" id="line-width" min="0.5" max="10.0" value="2.0" step="0.1">
                        </div>
                    </div>

                    <!-- Z-Order Curve Parameters -->
                    <div id="zorder-params" class="pattern-params" style="display: none;">
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.75rem;">
                            Z-Order (Morton) curve using recursive Z-pattern subdivision. Simpler and faster to generate
                            than Hilbert or Peano. Creates distinctive diagonal patterns.
                        </p>
                        <div class="control-group">
                            <label for="iterations">
                                Iterations: <span id="iterations-value">5</span>
                            </label>
                            <input type="range" id="iterations" min="1" max="8" value="5" step="1">
                        </div>
                        <div class="control-group">
                            <label for="line-width">
                                Line Width: <span id="line-width-value">2.0</span>
                            </label>
                            <input type="range" id="line-width" min="0.5" max="10.0" value="2.0" step="0.1">
                        </div>
                    </div>

                    <!-- Gosper Curve Parameters -->
                    <div id="gosper-params" class="pattern-params" style="display: none;">
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.75rem;">
                            Gosper (Flowsnake) hexagonal space-filling curve. Uses L-system generation for organic hexagonal
                            patterns. Recommended max iterations: 5-6 (grows as 7^n).
                        </p>
                        <div class="control-group">
                            <label for="iterations">
                                Iterations: <span id="iterations-value">4</span>
                            </label>
                            <input type="range" id="iterations" min="1" max="6" value="4" step="1">
                        </div>
                        <div class="control-group">
                            <label for="line-width">
                                Line Width: <span id="line-width-value">2.0</span>
                            </label>
                            <input type="range" id="line-width" min="0.5" max="10.0" value="2.0" step="0.1">
                        </div>
                    </div>

                    <!-- Size Specification -->
                    <div class="control-group">
                        <label>Size Mode:</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="size-mode" value="pixel" checked>
                                Pixels
                            </label>
                            <label>
                                <input type="radio" name="size-mode" value="physical">
                                Physical + DPI
                            </label>
                        </div>
                    </div>

                    <!-- Pixel Mode Controls -->
                    <div id="pixel-size-controls" class="size-controls">
                        <div class="control-group">
                            <label for="width-px">Width (px):</label>
                            <input type="number" id="width-px" min="256" max="4096" value="1000" step="64">
                        </div>
                        <div class="control-group">
                            <label for="height-px">Height (px):</label>
                            <input type="number" id="height-px" min="256" max="4096" value="1000" step="64">
                        </div>
                    </div>

                    <!-- Physical Mode Controls -->
                    <div id="physical-size-controls" class="size-controls" style="display: none;">
                        <div class="control-group">
                            <label for="width-physical">Width:</label>
                            <div class="input-with-unit">
                                <input type="number" id="width-physical" min="1" max="100" value="8.5" step="0.1">
                                <select id="unit-select">
                                    <option value="in">in</option>
                                    <option value="mm">mm</option>
                                </select>
                            </div>
                        </div>
                        <div class="control-group">
                            <label for="height-physical">Height:</label>
                            <div class="input-with-unit">
                                <input type="number" id="height-physical" min="1" max="100" value="11" step="0.1">
                                <span class="unit-display" id="height-unit">in</span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label for="dpi">DPI:</label>
                            <input type="number" id="dpi" min="72" max="600" value="300" step="1">
                        </div>
                    </div>

                    <!-- Calculated Dimensions Display -->
                    <div class="control-group info-display">
                        <label>Output Size:</label>
                        <div class="info-value">
                            <span id="output-dimensions">1000 × 1000 px</span>
                            <button id="match-image-size-btn" class="btn btn-secondary" style="margin-left: 0.5rem; padding: 0.25rem 0.5rem; font-size: 0.85rem;" disabled>
                                Match Image Size
                            </button>
                        </div>
                    </div>

                    <div class="control-group checkbox">
                        <label>
                            <input type="checkbox" id="invert">
                            Invert Pattern
                        </label>
                    </div>
                </div>

                <div class="actions">
                    <button id="generate-btn" class="btn btn-primary">Generate Pattern</button>
                    <button id="cancel-generate-btn" class="btn btn-secondary" style="display: none;">Cancel</button>
                </div>

                <div id="generate-progress" class="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div id="generate-progress-fill" class="progress-fill"></div>
                    </div>
                    <p id="generate-progress-text" class="progress-text">0%</p>
                </div>

                <div class="canvas-container">
                    <canvas id="pattern-canvas"></canvas>
                </div>

                <div class="actions">
                    <div class="download-group">
                        <select id="export-format">
                            <option value="png">PNG</option>
                            <option value="pdf">PDF</option>
                        </select>
                        <button id="download-pattern-btn" class="btn btn-secondary" disabled>
                            Download Pattern
                        </button>
                    </div>
                </div>
            </section>

            <!-- Darkness Analysis Section -->
            <section class="panel">
                <h2>Darkness Analysis</h2>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                    Analyze pattern darkness distribution. Red overlay indicates too-dark regions, green indicates too-light regions.
                    Generate a pattern above or import an existing one to analyze.
                </p>

                <div class="controls">
                    <div class="control-group">
                        <label for="import-pattern">Import Pattern to Analyze:</label>
                        <input type="file" id="import-pattern" accept="image/png,image/jpeg,application/pdf">
                    </div>

                    <div class="control-group">
                        <label for="analysis-radius">
                            Analysis Radius: <span id="analysis-radius-value">0.125</span> in
                        </label>
                        <input type="range" id="analysis-radius" min="0.0625" max="0.5" value="0.125" step="0.0625">
                    </div>

                    <div class="control-group">
                        <label for="upper-threshold">
                            Too Dark Threshold: <span id="upper-threshold-value">70</span>%
                        </label>
                        <input type="range" id="upper-threshold" min="50" max="90" value="70" step="5">
                    </div>

                    <div class="control-group">
                        <label for="lower-threshold">
                            Too Light Threshold: <span id="lower-threshold-value">30</span>%
                        </label>
                        <input type="range" id="lower-threshold" min="10" max="50" value="30" step="5">
                    </div>

                    <div class="control-group checkbox">
                        <label>
                            <input type="checkbox" id="show-overlay" checked>
                            Show Overlay
                        </label>
                    </div>
                </div>

                <div class="actions">
                    <button id="analyze-btn" class="btn btn-primary" disabled>Analyze Darkness</button>
                    <button id="cancel-analysis-btn" class="btn btn-secondary" style="display: none;">Cancel</button>
                </div>

                <div id="analysis-progress" class="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div id="analysis-progress-fill" class="progress-fill"></div>
                    </div>
                    <p id="analysis-progress-text" class="progress-text">0%</p>
                </div>

                <div class="canvas-container">
                    <canvas id="analysis-canvas"></canvas>
                </div>

                <div id="analysis-stats" class="stats-panel" style="display: none;">
                    <h3>Analysis Results</h3>
                    <div id="stats-content"></div>
                    <div class="legend">
                        <div class="legend-item">
                            <span class="legend-color" style="background: rgba(255, 0, 0, 0.5);"></span>
                            <span>Too Dark</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: rgba(0, 255, 0, 0.5);"></span>
                            <span>Too Light</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Image Halftone Section -->
            <section class="panel">
                <h2>Apply Halftone</h2>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                    Apply generated SDF patterns as halftone effects to your images.
                </p>

                <div class="controls">
                    <div class="control-group">
                        <label for="image-upload">Upload Image:</label>
                        <input type="file" id="image-upload" accept="image/png,image/jpeg">
                    </div>

                    <div class="control-group info-display" id="image-info" style="display: none;">
                        <label>Image Size:</label>
                        <div class="info-value">
                            <span id="image-dimensions">—</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label for="halftone-method">Method:</label>
                        <select id="halftone-method">
                            <option value="threshold">Threshold</option>
                            <option value="blend">Blend</option>
                            <option value="floyd-steinberg">Floyd-Steinberg Dithering</option>
                            <option value="ordered">Ordered Dithering (Bayer)</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label for="halftone-contrast">
                            Contrast: <span id="halftone-contrast-value">0</span>
                        </label>
                        <input type="range" id="halftone-contrast" min="-100" max="100" value="0" step="5">
                        <p style="font-size: 0.75rem; color: var(--text-secondary); margin: 0.25rem 0 0 0;">
                            Adjust contrast of final halftone result
                        </p>
                    </div>

                    <div class="control-group">
                        <label for="halftone-brightness">
                            Brightness: <span id="halftone-brightness-value">0</span>
                        </label>
                        <input type="range" id="halftone-brightness" min="-100" max="100" value="0" step="5">
                        <p style="font-size: 0.75rem; color: var(--text-secondary); margin: 0.25rem 0 0 0;">
                            Adjust brightness of final halftone result
                        </p>
                    </div>
                </div>

                <div class="actions">
                    <button id="apply-halftone-btn" class="btn btn-primary" disabled>
                        Apply Halftone
                    </button>
                    <button id="cancel-halftone-btn" class="btn btn-secondary" style="display: none;">Cancel</button>
                </div>

                <div id="halftone-progress" class="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div id="halftone-progress-fill" class="progress-fill"></div>
                    </div>
                    <p id="halftone-progress-text" class="progress-text">0%</p>
                </div>

                <div class="canvas-container">
                    <canvas id="result-canvas"></canvas>
                </div>

                <div class="actions">
                    <button id="download-result-btn" class="btn btn-secondary" disabled>
                        Download Result
                    </button>
                </div>
            </section>
        </main>

        <footer>
            <p>
                Halftonish v0.1.0-dev |
                <a href="https://github.com/yourusername/halftonish" target="_blank">GitHub</a> |
                <a href="architecture.md" target="_blank">Docs</a>
            </p>
        </footer>
    </div>

    <!-- External libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <!-- Main application script -->
    <script type="module" src="app.js"></script>
</body>
</html>
